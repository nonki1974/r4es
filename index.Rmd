---
title: "Rによるデータ解析入門"
author: "Tomokazu FUJINO (@nonki1974)"
site: bookdown::bookdown_site
output:
  bookdown::gitbook:
    split_by: section
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Rの基礎（データ構造とデータ型）{#R_basics}

ここでは、データは数値や文字の集まりであると考えます。Rで標準的に利用できるデータの格納方法（データ構造）は以下の4つです。

- **ベクトル**（vector）
- **配列・行列**（array, matrix）
- **リスト**（list）
- **データフレーム**（data frame）

一方、個々のデータそのものの種類をデータ型と呼び、Rでは主に以下の3つを利用します。

- **数値型**（numeric）
- **文字型**（charater）
- **因子型**（factor）

特に、因子型は他のプログラミング言語にはないデータ型で、統計解析環境であるRならではのデータ型となっています。

## ベクトル {#vector}

Rにおける最もシンプルなデータ構造が**ベクトル**です。Rにおいては、単一の数値であっても、大きさ1のベクトルとして扱われます。例えば、以下のような演算を実行した結果の数値も大きさ1のベクトルです。結果に表示される`[1]`はそのすぐ右にある数値がベクトルの1番目の要素であることを示しています。

```{r}
3+4
sqrt(9)
sin(pi/6)
```

多くの要素を持つベクトルの場合、例えば正規乱数を12個生成した結果のベクトルは以下のように表示されます。

```{r}
rnorm(12)
```

### オブジェクトと変数

Rのコンソールにコマンドを入力すると、Rは何らかの結果をベクトルなどの形で出力してくれます。これらを総称して**オブジェクト**と呼びます。上のようなコマンドでは出力された結果のオブジェクトは再利用できませんが、**変数**に代入することで、再利用することができます。例えば、

```{r}
x <- rnorm(12)
```

とすると、実行結果には何も表示されませんが、変数`x`の中に実行結果が格納されます。`<-`（代入演算子と呼びます）は、左辺の変数に右辺の実行結果を代入しなさいという意味になります。つまり、`x`に`rnorm(12)`の結果のオブジェクトが格納されたということになります。`x`の中に何が入っているかを知りたい場合は、コンソールに`x`と入力します。

```{r}
x
```

変数名には、文字、数字、ピリオドなどの記号が利用できますが先頭に数字がつくものは使えません。また、**大文字と小文字を区別します**ので、注意しましょう。実際に分析するときは、分析者にとって分かりやすく、また複数の分析者で分析する場合は他の人が見てもある程度推測できるような変数名にするとよいです。

```{r}
student_id <- 1200
```

任意のベクトルを作成する場合は、`c()`関数^[cはcombineの短縮形]を用います。

```{r}
x <- c(3, 6, 10)
x
y <- c(sin(pi/6), sqrt(9))
y
```

### 便利なベクトル作成法

規則的に並んだ数値を要素とするベクトルを作成するには、いくつかの便利な方法があります。

```{r}
# 1ずつ増加する数列
1:10
# 同じ数値の繰り返し
rep(10, 5)
# 増分を指定した数列（任意の公差をもつ等差数列）
seq(1, 2, 0.1)
```

### ベクトルの演算

ベクトル同士の演算は、2つのベクトルの大きさが同じ場合には要素同士の演算結果がベクトルとして返されます。

```{r}
x <- c(3, 6, 10)
y <- c(3, 2, 5)
x + y
x - y
x * y
x / y
```

2つのベクトルの大きさが異なる場合には、小さい方のベクトルの要素が、大きい方と同じ大きさになるまで「リサイクル」されます。以下のコマンドは`x^c(2, 2, 2)`と同じであると理解しましょう。

```{r}
x^2
```

以下のように、大きい方のベクトルの大きさが、小さい方の大きさの定数倍でない場合には警告が出力されます。

```{r}
z <- c(1, 2)
x * z
```

### ベクトルの要素の参照

ベクトルの要素を参照する場合は、`[]`を以下のように使います。

```{r}
x[2]
x[2:3]
x[c(1, 3)]
```

### ベクトルに対する便利な関数

複数の処理をまとめたものを**関数**（function）といいます。関数にはRに元々組み込まれているものもありますし、自分で関数を作ることもできます。関数は `関数名()` の形式で呼び出すことができ、`()`内にオブジェクトを記述することで、関数はそのオブジェクトに対して定められた処理を実行します。`()`内に記述するオブジェクトを**引数**（ひきすう）と呼びます。

ベクトルに対しては、以下のような関数がよく用いられます。

```{r}
# ベクトルの大きさ（要素数）を出力する
length(x)
# 数値ベクトルの合計を出力する
sum(x)
# 数値ベクトルの平均を出力する
mean(x)
# 数値ベクトルの標準偏差（standard deviation）を出力する
sd(x)
```

### 数値型と文字型

これまで扱ってきたベクトルに格納しているデータはすべて**数値型**（numeric）でした。Rでは文字列もデータとして扱うことができ、**文字型**（character）のデータと呼びます。文字型のデータはダブルクォート`"`で囲むことによって表現します。

```{r}
s <- c("Kasumi", "Nadeshiko", "Kashii")
s
```

**ベクトルは、異なるデータ型を混在させることはできません。**数値型と文字型が混在したベクトルを作成しようとすると、数値型が文字型に強制変換されます。

```{r}
c("Happy", "New", "Year", 2021)
```

`class()`関数によってオブジェクトの型を確認することができます。

```{r}
class(x)
class(s)
```

## 配列と行列 {#arrayandmatrix}

ベクトルに次元属性を与えることにより、配列として扱えるようになります。

```{r}
x <- 1:9
x
# xを3x3の2次元配列（行列）として扱う
dim(x) <- c(3, 3)
x

x3 <- 1:27
# x3を3x3x3の3次元配列として扱う
dim(x3) <- c(3, 3, 3)
x3
```
`dim()`関数により次元属性が与えられ、引数には各次元の要素数を指定します。配列の各要素は、各次元の要素番号を指定しても、ベクトルとしての要素番号を指定しても参照できます。
```{r}
x3[1, 2, 1]
x3[4]
```
特に2次元配列である行列を作成する場合には、`matrix()`関数を使うことができます。
```{r}
matrix(1:15, ncol=5, byrow=TRUE)
```
最初の引数でベクトルを指定します`ncol`は行列の列数、`byrow`は行方向にベクトルの要素を並べるかどうかを`TRUE`か`FALSE`で指定します（デフォルトは`FALSE`）。


